
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="REANNZ">
      
      
        <link rel="canonical" href="https://nesi.github.io/training-environment/tutorials/adding-new-app/">
      
      
        <link rel="prev" href="../..">
      
      
        <link rel="next" href="../deployment-on-nesi/">
      
      
      <link rel="icon" href="../../images/REANNZ_logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Adding a new app - REANNZ Training Environment</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#adding-a-new-app" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="REANNZ Training Environment" class="md-header__button md-logo" aria-label="REANNZ Training Environment" data-md-component="logo">
      
  <img src="../../images/REANNZ_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            REANNZ Training Environment
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Adding a new app
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/nesi/training-environment" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    nesi/training-environment
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="REANNZ Training Environment" class="md-nav__button md-logo" aria-label="REANNZ Training Environment" data-md-component="logo">
      
  <img src="../../images/REANNZ_logo.png" alt="logo">

    </a>
    REANNZ Training Environment
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/nesi/training-environment" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    nesi/training-environment
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Adding a new app
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Adding a new app
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-needs-to-be-changed" class="md-nav__link">
    <span class="md-ellipsis">
      What needs to be changed
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ci-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      CI pipeline
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-tagrelease-of-your-new-app" class="md-nav__link">
    <span class="md-ellipsis">
      Creating a tag/release of your new app
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-your-app-to-the-training-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Adding your app to the training environment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#developing" class="md-nav__link">
    <span class="md-ellipsis">
      Developing
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deployment-on-nesi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deploying a training environment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../jupyterlab-app-for-intermediate-shell-for-bioinformatics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    JupyterLab app for Intermediate Shell for Bioinformatics
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes-for-trainers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Notes for trainers
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../known-issues/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Known issues
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-needs-to-be-changed" class="md-nav__link">
    <span class="md-ellipsis">
      What needs to be changed
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ci-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      CI pipeline
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-tagrelease-of-your-new-app" class="md-nav__link">
    <span class="md-ellipsis">
      Creating a tag/release of your new app
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-your-app-to-the-training-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Adding your app to the training environment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#developing" class="md-nav__link">
    <span class="md-ellipsis">
      Developing
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="adding-a-new-app">Adding a new app</h1>
<h2 id="overview">Overview</h2>
<p>The suggested approach is to copy the existing app that most closely resembles your new app and modify that, we will document this approach here.
Some of the existing apps are:</p>
<ul>
<li><a href="https://github.com/nesi/training-environment-jupyter-containers-app">Apptainer workshop app</a><ul>
<li>based on JupyterLab</li>
</ul>
</li>
<li><a href="https://github.com/nesi/training-environment-jupyter-intermediate-shell-app">Intermediate shell workshop app</a><ul>
<li>based on JupyterLab</li>
<li>there is a <a href="../jupyterlab-app-for-intermediate-shell-for-bioinformatics/">tutorial</a> for this app</li>
</ul>
</li>
<li><a href="https://github.com/nesi/training-environment-jupyter-ml101-app">Jupyter ML101 app</a><ul>
<li>based on JupyterLab</li>
<li>uses Miniconda to install dependencies</li>
</ul>
</li>
<li><a href="https://github.com/nesi/training-environment-jupyter-ml102-app">Jupyter ML102 app</a><ul>
<li>based on JupyterLab</li>
<li>uses Python virtualenv and pip to install dependencies</li>
</ul>
</li>
<li><a href="https://github.com/nesi/training-environment-rstudio-rnaseq-app">RStudio RNA-Seq app</a><ul>
<li>based on RStudio</li>
<li>includes data files in the docker image</li>
<li>uses Miniconda to install some dependencies such as <code>samtools</code> and <code>fastqc</code></li>
<li>uses <code>BiocManager</code> and <code>install.packages</code> to install R dependencies</li>
</ul>
</li>
<li><a href="https://github.com/nesi/training-environment-rstudio-scrnaseq-app">RStudio scRNA-Seq app</a></li>
<li><a href="https://github.com/nesi/training-environment-rstudio-app">RStudio intro and intermediate R app</a></li>
</ul>
<div class="admonition info">
<p class="admonition-title">Note about naming your git repo</p>
<p>When you copy an existing app repo you should take care when naming your new repository - make sure you do not use underscores - use hyphens instead as github packages do not support package names with underscores and the default github action we include uses the repository name for the package name</p>
</div>
<h2 id="what-needs-to-be-changed">What needs to be changed</h2>
<p>Here we summarise what is most likely to need to be changed when copying an existing app.
Assuming the app your are copying is based on the same web application (i.e. JupyterLab vs RStudio, etc.) then not much should need to change.</p>
<p>Some changes are likely to be required in the Open Ondemand application definition:</p>
<ul>
<li><em>view.html.erb</em><ul>
<li>change the line that contains the string <em>Connect to <app specific string></em>, replacing <em><app specific string></em> with something specific to your app</li>
</ul>
</li>
<li><em>manifest.yml</em><ul>
<li>change the <code>name</code> and <code>description</code></li>
</ul>
</li>
<li><em>form.yml</em><ul>
<li>adjust <code>cpu</code>, <code>memory</code>, <code>wall_time</code> if needed (can also add/remove any options)</li>
</ul>
</li>
<li><em>submit.yml.erb</em><ul>
<li>change <code>script.native.container.name</code> to something unique for your app</li>
<li>change <code>script.native.container.image</code> to the image that will be built for your app - this should look like your github repo name and include a label/version (you will need to create a git tag for the version you put here)</li>
</ul>
</li>
<li><em>template/script.sh.erb</em><ul>
<li>copy any data from your image before launching the app, e.g. using something like
  <div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>rsync --ignore-existing -avz /path/in/docker/image/to/data/ ~/data/
</span></code></pre></div>
  will copy the data from your image into the user's home directory</li>
<li>make sure this file is executable otherwise the app will fail to launch (<code>chmod +x template/script.sh.erb</code>)</li>
</ul>
</li>
</ul>
<p>The <em>Dockerfile</em> that defines the application environment (software and any data that is required) may also need to be changed:</p>
<ul>
<li><em>docker/Dockerfile</em><ul>
<li>add additional packages and install steps (generally not a good idea to remove packages unless you know what you are doing)</li>
<li>add any required data</li>
</ul>
</li>
</ul>
<h2 id="ci-pipeline">CI pipeline</h2>
<p>The starting point apps listed above contain a default GitHub Actions workflow that automatically builds the docker image when you push to the repo. It will build git branches and tags and tag the docker images with the git branch or tag name. This should not need to be changed.</p>
<h2 id="creating-a-tagrelease-of-your-new-app">Creating a tag/release of your new app</h2>
<p>In order to deploy your app in the training environment we are going to tag a version/release of it, using git tags.</p>
<ol>
<li>Update the version label in <code>script.native.container.image</code> in <em>submit.yml.erb</em> to reflect the new version you are about to create, commit that file. For example, here we are going to release version "v0.2.2": <code>image: "ghcr.io/nesi/training-environment-rstudio-rnaseq-app:v0.2.2"</code></li>
<li>Create a tag with that specific version, e.g. <code>git tag -a v0.2.2 -m "my new release"</code></li>
<li>Push the tags, e.g. <code>git push --tags</code></li>
<li>This should trigger a build of the docker image, check the "Actions" tab of your GitHub repo and wait for it to complete successfully</li>
</ol>
<h2 id="adding-your-app-to-the-training-environment">Adding your app to the training environment</h2>
<p>To add you app to the training environment you need to modify the <a href="https://github.com/nesi/training-environment">training-environment repo</a>, specifically the file <em>vars/ondemand-config.yml.example</em>:</p>
<ol>
<li>Identify the <code>ood_apps</code> section in the file <em>vars/ondemand-config.yml.example</em></li>
<li>This section consists of a number of blocks, one for each app, so add a new block for your new app:
    <div class="language-yaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nt">rstudio_rnaseq</span><span class="p">:</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">  </span><span class="nt">k8s_container</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io/nesi/training-environment-rstudio-rnaseq-app:v0.2.2</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">  </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/nesi/training-environment-rstudio-rnaseq-app.git</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;v0.2.2&#39;</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">  </span><span class="nt">pre_pull</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span></code></pre></div></li>
<li>Next time you build the environment the new app should be included</li>
</ol>
<p>More detail on the keys above follows:</p>
<ul>
<li><code>rstudio_rnaseq</code> should be set to a unique value in the <code>ood_apps</code> block</li>
<li><code>k8s_container</code> must point to the docker image for your app, tagged with the specific version (the git tag you created above)</li>
<li><code>repo</code> the github repo for your app</li>
<li><code>version</code> should be the git tag you created above</li>
<li><code>enabled: true</code> so that your app shows up in ondemand</li>
<li><code>pre_pull: false</code> is a good default and can be changed to <code>true</code> when you are using that app in a training</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Releasing a new version of your app</p>
<p>When you release a new version of your app you need to update both the <code>k8s_container</code> and <code>version</code> values with the new version of your app</p>
</div>
<h2 id="developing">Developing</h2>
<p>When developing it can be useful to point the image in <em>submit.yml</em> to a branch name instead of a
tag, as that way you can test updates to your <em>Dockerfile</em> without having to rerun the environment deployment.</p>
<p>For example, let's say you are developing the app in the <em>dev</em> branch of your git repo called <em>training-environment-new-app</em>, we could set <code>script.native.container.image</code> in <em>submit.yml</em> to use the <em>dev</em> tag and also set <code>script.native.container.image_pull_policy</code> to always pull the latest version of the image.</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ghcr.io/nesi/training-environment-new-app:dev&quot;</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span><span class="nt">image_pull_policy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
</span></code></pre></div>
<p>Now, whenever you push a change to the <em>Dockerfile</em> in the <em>dev</em> branch of the git repo the following will happen:</p>
<ol>
<li>The default CI workflow will build a new Docker image and tag it with <em>dev</em> (check that the build completes successfully by going to the <em>Actions</em> tab in the GitHub web interface)</li>
<li>After the image has been built, if you relaunch your app in ondemand, it will pull the new version of the <em>dev</em> image and launch the app using that</li>
</ol>
<p>With this approach, ondemand will pick up your changes to the docker image immediately without needing to change the <code>k8s_container</code> or <code>version</code> values in <em>vars/ondemand-config.yml</em> or redeploy the environment.</p>
<div class="admonition note">
<p class="admonition-title">Moving to production</p>
<p>When you have finished developing your app, it is recommended to switch to using versioned tags, such as <em>v0.1.0</em>, rather than branch names, for better reproducibility, and to remove the <code>image_pull_policy: Always</code> line, so that application launches are not reliant on connectivity to the docker registry.</p>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.expand"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>